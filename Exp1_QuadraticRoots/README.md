# 实验一：灾难性抵消 - 求解二次方程

## 实验目的

1.  理解“灾难性抵消”现象：当两个几乎相等的数相减时，有效数字会大量丢失，导致相对误差显著增大。
2.  观察标准二次方程求根公式 \(x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}\) 在特定条件下（\(b^2 \gg |4ac|\)）的数值不稳定性。
3.  学习并实现一种数值更稳定的求根算法。
4.  比较不同算法在单精度 (float32) 和双精度 (float64) 下的表现。

## 背景知识

对于二次方程 \(ax^2 + bx + c = 0\)，其解由以下公式给出：
\[ x_1 = \frac{-b + \sqrt{b^2 - 4ac}}{2a} \]
\[ x_2 = \frac{-b - \sqrt{b^2 - 4ac}}{2a} \]

当 \(b^2 \gg |4ac|\) 时，\(\sqrt{b^2 - 4ac} \approx |b|\)。
*   如果 \(b > 0\)，那么 \(-b + \sqrt{b^2 - 4ac}\) 就是两个相近的数相减，计算 \(x_1\) 时可能发生灾难性抵消。
*   如果 \(b < 0\)，那么 \(-b - \sqrt{b^2 - 4ac}\) 就是两个相近的数相减，计算 \(x_2\) 时可能发生灾难性抵消。

**数值稳定的替代方法:**
可以先计算数值稳定的根，然后利用韦达定理 \(x_1 x_2 = c/a\) 来计算另一个根。
*   如果 \(b > 0\)，则 \(x_2 = \frac{-b - \sqrt{b^2 - 4ac}}{2a}\) 是稳定的。然后计算 \(x_1 = \frac{c}{a x_2}\)。
*   如果 \(b < 0\)，则 \(x_1 = \frac{-b + \sqrt{b^2 - 4ac}}{2a}\) 是稳定的。然后计算 \(x_2 = \frac{c}{a x_1}\)。
*   一个统一的稳定公式是：先计算 \(x_{\text{stable}} = \frac{-b - \text{sgn}(b) \sqrt{b^2 - 4ac}}{2a}\)，然后计算 \(x_{\text{other}} = \frac{c}{a x_{\text{stable}}}\)。(注意处理 \(a=0\) 或 \(c=0\) 的情况)

## 实验步骤

1.  **实现标准公式:** 在 `quadratic_solver.py` 文件中，完成 `solve_quadratic_standard` 函数，使用标准的二次方程求根公式计算两个根。注意处理输入参数的数据类型（单/双精度）。
2.  **实现稳定公式:** 在 `quadratic_solver.py` 文件中，完成 `solve_quadratic_stable` 函数，使用上面介绍的数值稳定方法计算两个根。
3.  **测试案例:**
    *   考虑方程 \(x^2 - 10^6 x + 1 = 0\)。这里 \(a=1, b=-10^6, c=1\)。\(b^2 = 10^{12}\) 远大于 \(|4ac|=4\)。精确解约为 \(x_1 \approx 10^6\) 和 \(x_2 \approx 10^{-6}\)。
    *   使用你的两个函数，分别在 **双精度 (float64)** 和 **单精度 (float32)** 下计算这个方程的根。
4.  **分析结果:**
    *   比较标准公式和稳定公式得到的结果。哪个公式在哪种精度下给出的 \(x_2\) (较小的根) 更准确？
    *   计算相对误差（可以使用 `numpy.roots` 或更高精度的库如 `mpmath` 作为参考真值）。
    *   解释观察到的现象，说明灾难性抵消是如何发生的。

## 代码模板 (`quadratic_solver.py`)

请在你克隆的仓库中找到 `Exp1_CatastrophicCancellation/quadratic_solver.py` 文件并完成其中的函数。

## 实验报告要求

在你的总实验报告中，为本实验创建一个部分，包含：

1.  **目的:** 简述本实验的目标。
2.  **方法:** 描述你使用的标准公式和稳定公式。
3.  **结果:**
    *   表格形式展示 \(a=1, b=-10^6, c=1\) 时，两种方法在 float32 和 float64 精度下计算得到的 \(x_1, x_2\)。
    *   计算并展示 \(x_2\) 的相对误差（与精确值 \( \approx 10^{-6} \) 或更高精度计算值比较）。
4.  **讨论:**
    *   解释为什么标准公式在计算 \(x_2\) 时会失效，尤其是在单精度下。指出哪一步发生了灾难性抵消。
    *   比较单精度和双精度的结果差异。
    *   评价稳定算法的有效性。
5.  **结论:** 总结从本实验中学到的关于数值稳定性的知识。